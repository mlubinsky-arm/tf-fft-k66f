/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
==============================================================================*/

#include "tensorflow/lite/micro/examples/micro_speech/main_functions.h"

#include "tensorflow/lite/micro/examples/micro_speech/audio_provider.h"
//#include "tensorflow/lite/micro/examples/micro_speech/command_responder.h"
//#include "tensorflow/lite/micro/examples/micro_speech/feature_provider.h"
#include "tensorflow/lite/micro/examples/micro_speech/micro_features/micro_model_settings.h"
#include "tensorflow/lite/micro/examples/micro_speech/micro_features/model.h"
//#include "tensorflow/lite/micro/examples/micro_speech/recognize_commands.h"
#include "tensorflow/lite/micro/kernels/micro_ops.h"
#include "tensorflow/lite/micro/micro_error_reporter.h"
#include "tensorflow/lite/micro/micro_interpreter.h"
#include "tensorflow/lite/micro/micro_mutable_op_resolver.h"
#include "tensorflow/lite/schema/schema_generated.h"
#include "tensorflow/lite/version.h"

//#include "tensorflow/lite/micro/all_ops_resolver.h"

#define ARM_MATH_CM4
#include "arm_math.h"
#include "arm_const_structs.h"

#include "mbed.h"
//#include "tensor_thread.h"
DigitalOut led(LED1);


// Globals, used for compatibility with Arduino-style sketches.
namespace {
tflite::ErrorReporter* error_reporter = nullptr;
const tflite::Model* model = nullptr;
tflite::MicroInterpreter* interpreter = nullptr;
TfLiteTensor* model_input = nullptr;
//FeatureProvider* feature_provider = nullptr;
//RecognizeCommands* recognizer = nullptr;
int32_t previous_time = 0;

// Create an area of memory to use for input, output, and intermediate arrays.
// The size of this will depend on the model you're using, and may need to be
// determined by experimentation.
constexpr int kTensorArenaSize = 10 * 1024;
uint8_t tensor_arena[kTensorArenaSize];

//int8_t feature_buffer[kFeatureElementCount];
static int  fft_samples[FFT_SIZE];
static q15_t s[FFT_SIZE*2]; //has to be twice FFT size

//int8_t* int_model_input_buffer = nullptr;
float* float_model_input_buffer = nullptr;
}  // namespace

// The name of this function is important for Arduino compatibility.
void setup() {
  // Set up logging. Google style is to avoid globals or statics because of
  // lifetime uncertainty, but since this has a trivial destructor it's okay.
  // NOLINTNEXTLINE(runtime-global-variables)
  static tflite::MicroErrorReporter micro_error_reporter;
  error_reporter = &micro_error_reporter;

  // Map the model into a usable data structure. This doesn't involve any
  // copying or parsing, it's a very lightweight operation.
  model = tflite::GetModel(g_model);
  if (model->version() != TFLITE_SCHEMA_VERSION) {
    TF_LITE_REPORT_ERROR(error_reporter,
                         "Model provided is schema version %d not equal "
                         "to supported version %d.",
                         model->version(), TFLITE_SCHEMA_VERSION);
    return;
  }

  // Pull in only the operation implementations we need.
  // This relies on a complete list of all the ops needed by this graph.
  // An easier approach is to just use the AllOpsResolver, but this will
  // incur some penalty in code space for op implementations that are not
  // needed by this graph.
  //
  //static  tflite::AllOpsResolver micro_op_resolver;
  //  static tflite::ops::micro::AllOpsResolver micro_op_resolver;
  //  static tflite::micro::AllOpsResolver micro_op_resolver;
  // NOLINTNEXTLINE(runtime-global-variables)
   static tflite::MicroMutableOpResolver<2> micro_op_resolver(error_reporter);
  /*
  printf("\n adding AddDepthwiseConv2D");
  if (micro_op_resolver.AddDepthwiseConv2D() != kTfLiteOk) {
    return;
  }

  printf("\n adding AddSoftmax");
  if (micro_op_resolver.AddSoftmax() != kTfLiteOk) {
    return;
  }

  printf("\n adding AddReshape");
  if (micro_op_resolver.AddReshape() != kTfLiteOk) {
    printf("\n ERROR adding Reshape");
    return;
  }
*/
  printf("\n adding Logistic");
  if (micro_op_resolver.AddLogistic() != kTfLiteOk) {
     printf("\n ERROR adding adding Logistic");
    return;
  }

    printf("\n adding AddFullyConnected");
  if (micro_op_resolver.AddFullyConnected() != kTfLiteOk) {
    printf("\n ERROR adding AddFullyConnected");
    return;
  }
  // Build an interpreter to run the model with.
  static tflite::MicroInterpreter static_interpreter(
      model, micro_op_resolver, tensor_arena, kTensorArenaSize, error_reporter);
  interpreter = &static_interpreter;

printf("\n BEFORE AllocateTesnors");
  // Allocate memory from the tensor_arena for the model's tensors.
  TfLiteStatus allocate_status = interpreter->AllocateTensors();
  if (allocate_status != kTfLiteOk) {
    TF_LITE_REPORT_ERROR(error_reporter, "AllocateTensors() failed");
    return;
  }

printf("\n BEFORE interpreter->input(0)");

  // Get information about the memory area to use for the model's input.
  model_input = interpreter->input(0);

int k=0;
while (k<5){
  printf("\n BEFORE kFeatureElementCount =%d ", kFeatureElementCount); 
  printf("\n BEFORE model_input->dims->size =%d ", model_input->dims->size);
  printf("\n BEFORE model_input->dims->data[0] =%d ", model_input->dims->data[0]);
  printf("\n BEFORE model_input->dims->data[1] =%d ", model_input->dims->data[1]);
  k++;
}
// .lite/micro/examples/micro_speech/micro_features/micro_model_settings.h
//printf("\n BEFORE kFeatureSliceCount =%d ", kFeatureSliceCount); //49
//printf("\n BEFORE kFeatureSliceSize =%d ", kFeatureSliceSize); //40

  if ((model_input->dims->size != 2) || (model_input->dims->data[0] != 1) ||
     // (model_input->dims->data[1] != (kFeatureSliceCount * kFeatureSliceSize)) ||
      model_input->dims->data[1] != FFT_SIZE ||
      (model_input->type != kTfLiteFloat32)
      //(model_input->type != kTfLiteInt8)
      ) {
    TF_LITE_REPORT_ERROR(error_reporter,
                         "Bad input tensor parameters in model");
    return;
  }


  printf("\n BEFORE model_input_buffer = ...");


  //int_model_input_buffer = model_input->data.int8;
  float_model_input_buffer = model_input->data.f;

/*
const   int s_1[]   = {
7,0,8,2,7,7,8,2,1,4,11,7,4,17,18,15,13,6,23,25,8,14,11,9,14,3,16,13,6,5,1,19,11,5,4,1,15,4,0,1,10,5,13,4,24,7,13,0,10,0,6,10,3,5,9,6,1,1,2,7,1,14,8,1,6,6,0,3,4,5,3,5,4,1,1,2,1,3,3,6,5,3,4,1,3,1,2,5,6,2,2,6,8,2,4,0,6,2,3,1,5,6,1,4,2,3,9,6,8,4,3,6,1,5,2,2,3,6,2,3,1,1,4,3,2,19,11,14,2,3,1,10,6,6,6,2,3,0,5,7,5,5,0,2,7,2,1,0,3,0,1,7,0,2,2,1,2,2,2,1,4,3,1,3,3,3,2,1,2,2,3,1,2,0,3,1,3,0,2,1,1,0,0,1,1,1,0,1,0,6,3,2,1,1,0,0,0,3,0,1,4,2,1,2,1,0,3,4,2,7,1,2,6,2,6,2,7,3,0,1,10,6,2,2,4,4,1,2,1,0,3,5,3,1,4,3,1,3,2,3,0,1,1,1,0,0,3,2,1,1,5,3,4,3,2,1,2,0,0,1,0,1,2,1,5,2,3,2,1,2,1,5,1,2,1,7,2,1,2,0,2,3,5,3,6,3,1,5,5,3,1,4,0,1,1,2,2,6,3,2,4,1,2,1,0,0,3,1,2,6,0,0,3,7,4,11,6,1,2,0,3,0,2,2,3,2,0,0,2,1,2,4,2,3,5,0,7,1,2,2,7,2,1,5,2,0,9,2,4,2,2,0,8,6,2,4,1,0,5,4,4,7,0,5,8,0,4,1,1,10,6,0,11,14,18,13,27,43,1,18,4,13,5,22,8,0,2,3,0,4,4,2,1,2,3,3,0,6,4,6,3,1,5,0,3,2,3,1,1,1,3,1,3,1,2,5,2,1,0,4,0,1,2,1,2,0,0,3,6,2,0,1,4,4,3,2,5,1,1,4,0,3,5,1,1,4,0,3,3,4,5,4,1,4,2,5,2,6,4,2,9,5,2,0,7,8,8,6,1,0,1,2,3,4,5,5,1,4,3,7,2,9,0,2,4,2,12,3,8,5,9,1,3,5,9,7,2,7,1,2,5,6,8,3,5,3,2,4,8,13,4,2,2,5,1,2,12,8,3,7,1,11,23,3,10,2,17,5,7,3,0,0,1,7,9,1,9,3,5,7,3,5,6,2,2,6,4,1,0,5,2,15,8,11,5,2,9,4,13,11,6,1,0,3,7,0,2,9,2,11,5,6,1,1,0,1,5,1,3,1,4,2,7,1,1,10,6,3,4,3,5,6,4,6,3,2,1,6,6,0,2,0,3,8,2,6,3,4,1,2,4,2,1,2,5,7,1,1,1,3,6,9,4,6,9,6,4,6,5,7,4,1,5,3,6,7,3,2,1,7,3,2,8,2,1,7,6,4,2,4,1,2,2,1,2,1,1,2,4,1,4,2,0,5,0,1,4,1,4,9,2,0,2,3,1,1,1,1,3,3,4,0,2,8,4,2,1,3,1,8,0,4,0,8,2,1,3,2,3,0,2,3,4,1,4,4,4,4,14,2,9,7,3,0,3,4,10,8,9,3,5,1,0,1,11,7,1,2,3,3,5,11,3,1,8,5,2,0,1,1,5,9,8,2,6,3,3,0,9,3,10,12,8,8,12,2,8,13,5,7,11,14,13,3,7,2,7,7,6,17,20,7,2,15,10,53,9,17,27,20,20,17,6,2,3,8,8,9,10,12,7,36,94,21,89,27,46,3,22,2,23,3,19,9,30,31,25,6,16,14,15,40,19,0,25,28,16,7,14,2,2,26,4,14,1,8,15,8,15,31,5,6,23,17,17,9,10,3,5,8,10,5,0,1,1,9,12,2,12,3,14,6,10,28,6,17,7,21,28,3,2,17,9,19,4,9,4,8,13,9,2,5,5,18,3,9,1,10,4,8,9,0,7,17,2,13,25,10,6,22,9,11,24,12,7,6,46,7,14,18,6,0,5,13,5,8,16,5,12,8,18,15,0,6,10,25,3,15,20,6,5,1,10,2,5,7,3,3,2,5,7,2,16,8,3,10,0,3,12,0,9,3,5,1,1,1,9,3,3,2,2,3,5,1,1,1,2,5,1,6,3,1,4,0,4,1,3,2,1,0,1,3,2,4,3,4,3,1,3,1,0,1,3,1,1,1,0,1,5,2,0,1,4,2,1,3,1,1,0,0,3,1,2,2,1,0,2,1,1,0,1,1,2,1,1,1,1,0,2,0,1,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,1,2,1,1,1,0,2,1,2,1,1,3,3,1,1,1,1,0,1,2,4,2,0,0,5,2,0,1,0,0,3,1,1,0,3,2,3,0,3,4,2,3,1,3,1,1,3,3,3,2,4,1,3,1,1,7,2,5,1,2,6,2,1,2,3,0,9,3,1,3,5,1,10,2,12,0,1,2,4,9,16,8,7,3,2,4,3,4,5,6,9,1,4,2,20,4,3,14,9,26,0,7,17,16,12,7,16,5,6,9,5,15,6,0,13,17,46,7,6,6,23,13,9,10,6,22,25,10,2,13,6,16,10,0,4,8,2,11,3,10,5,18,2,4,13,8,4,7,4,8,9,19,3,17,28,2,7,22,6,18,10,27,14,6,12,3,12,2,1,10,1,0,10,6,5,7,10,3,17,9,23,17,5,7,15,31,14,9,1,7,4,14,2,26,13,1,16,6,25,28,18,1,16,39,16,14,24,5,29,31,19,8,23,3,22,3,47,2,89,28,94,21,7,34,9,13,8,9,3,7,7,1,20,17,27,20,9,17,10,54,2,15,20,7,6,17,7,7,6,1,12,2,11,13,5,8,8,14,13,3,8,8,11,11,9,4,3,0,6,2,8,1,5,9,1,2,3,1,7,6,2,0,4,10,3,2,1,2,11,9,0,1,5,1,9,4,10,8,3,5,3,1,9,8,14,2,4,4,4,5,4,0,2,2,4,0,3,1,2,1,0,7,0,3,1,7,1,2,4,3,2,7,4,1,4,4,1,1,1,2,1,2,2,1,4,9,4,2,0,2,0,4,4,2,3,2,1,1,2,1,2,1,1,2,2,5,6,3,0,6,9,2,3,3,1,8,3,2,6,6,5,4,5,0,4,8,4,5,8,5,4,5,6,8,1,4,1,1,5,7,1,3,5,1,1,2,3,5,2,7,4,7,2,2,6,0,1,7,4,3,4,5,6,5,4,3,7,2,1,10,7,0,4,2,4,0,5,0,0,2,1,0,5,7,3,10,2,9,6,1,0,4,5,2,13,11,10,4,5,1,7,12,2,14,0,5,3,2,2,5,6,3,3,6,5,6,9,4,9,0,2,6,0,1,9,2,17,4,10,2,23,3,1,10,3,8,12,9,1,1,2,4,5,1,8,13,2,4,5,3,8,3,4,5,1,2,2,6,9,7,3,5,9,1,8,5,12,2,4,2,0,2,2,10,3,7,1,4,5,4,3,5,1,2,1,1,8,6,7,9,1,0,9,4,4,3,2,6,2,5,1,4,5,3,3,5,1,3,1,4,6,1,0,1,1,4,5,1,3,3,3,4,0,0,5,3,0,3,1,0,3,1,0,1,1,3,1,2,1,5,2,0,3,0,1,1,2,1,2,2,5,0,2,0,3,6,0,6,4,3,1,2,3,3,0,4,1,2,8,0,5,21,4,14,0,17,26,43,18,13,11,14,6,0,2,9,4,1,8,0,1,6,3,8,5,4,1,0,1,5,7,6,2,0,4,2,10,2,1,0,0,5,6,1,2,2,7,1,4,1,1,4,1,4,2,1,1,0,3,2,2,2,3,0,2,0,6,0,3,11,3,8,1,0,3,5,2,1,1,0,3,2,4,1,2,1,2,6,1,1,1,1,1,4,4,3,1,5,6,3,5,3,1,3,2,0,2,1,0,6,0,2,0,5,1,2,2,2,4,2,2,1,1,0,0,1,2,1,2,1,3,2,6,2,1,2,3,2,1,0,1,1,0,0,1,4,1,3,2,3,2,1,2,5,0,1,1,2,4,4,2,3,9,6,1,2,6,3,5,1,5,2,2,2,4,7,4,3,0,0,1,2,4,2,1,0,1,2,1,1,1,1,2,1,0,7,0,1,1,1,1,0,0,1,2,0,3,0,2,1,2,1,3,1,2,2,1,1,3,2,0,3,4,3,1,0,1,1,2,1,1,2,0,8,4,0,1,1,6,2,0,2,5,5,5,7,3,0,5,2,7,6,0,9,3,3,11,15,1,19,5,3,2,0,1,3,4,6,2,1,0,5,4,5,8,3,8,6,1,4,2,3,3,6,4,1,5,2,3,1,7,2,1,7,5,2,1,5,3,1,5,2,4,2,2,7,3,3,2,2,4,1,1,5,2,5,2,3,4,6,9,2,2,14,1,8,2,1,8,6,2,5,5,11,9,0,14,1,25,8,14,4,9,4,2,0,13,4,5,1,10,5,3,19,5,5,14,14,15,4,13,10,6,13,25,25,14,6,17,14,2,17,9,7,0,5,6,1,5,8,6,0
};
 
6,0,8,2,0,1,8,3,12,0,5,1,3,8,2,29,5,12,1,7,4,10,21,15,6,3,33,24,13,11,21,8,13,7,16,9,1,10,32,8,5,28,19,20,14,16,4,2,12,18,9,8,2,1,4,2,3,6,6,2,6,3,1,3,1,1,3,3,1,1,4,0,3,3,1,3,1,1,7,1,4,5,2,1,3,3,2,2,3,2,2,3,3,1,1,3,1,1,2,4,3,4,3,6,7,2,3,4,8,1,4,1,5,4,8,1,1,1,6,2,5,5,9,9,11,6,2,8,0,1,9,3,1,2,1,4,4,2,2,3,3,2,1,3,4,1,0,2,3,5,3,2,1,3,7,1,2,1,2,0,1,3,4,3,2,0,0,1,3,1,2,3,1,1,3,2,1,2,0,0,2,2,4,1,7,5,0,1,3,1,0,3,0,3,1,2,1,1,2,2,0,0,2,1,4,1,0,2,3,0,4,3,2,3,0,0,2,2,4,0,2,4,2,2,6,2,0,14,3,4,1,3,5,3,3,4,2,1,0,2,1,1,4,4,3,5,6,12,2,1,2,1,1,0,1,0,1,1,1,2,1,3,1,2,1,2,0,3,1,2,1,1,0,1,1,0,4,1,1,1,1,1,5,0,0,1,1,2,1,4,4,0,1,0,2,1,0,3,1,1,2,1,0,2,4,3,0,4,9,5,7,7,3,1,2,1,3,4,1,1,5,1,0,2,5,1,11,4,1,2,4,3,0,1,2,2,0,1,0,1,3,2,0,2,8,1,6,3,0,0,3,1,4,1,4,4,9,12,5,2,5,3,1,0,9,18,18,8,4,10,9,8,5,2,5,16,14,10,2,16,12,4,6,3,0,7,2,3,4,4,3,2,4,0,2,2,3,0,3,3,4,3,2,1,6,0,6,3,5,5,4,0,2,1,1,1,1,0,4,3,0,3,0,1,0,1,6,3,8,3,5,5,10,1,7,7,2,4,2,3,3,3,2,7,5,6,1,1,1,6,13,0,2,3,6,3,3,1,2,2,3,0,1,0,5,2,3,1,1,0,3,3,2,4,3,0,1,5,8,8,7,1,1,1,1,1,0,1,6,3,3,5,4,5,1,3,2,5,1,2,7,2,4,14,0,8,1,4,5,1,2,2,3,4,1,3,5,3,2,5,1,10,9,15,1,0,6,0,8,2,1,7,2,2,8,5,1,4,0,1,1,3,2,2,5,6,13,10,12,0,18,5,4,0,3,0,5,14,17,1,2,4,27,1,4,6,3,1,14,2,21,3,6,28,0,11,3,13,2,7,3,2,5,6,7,2,1,4,1,1,9,0,4,1,4,2,5,4,1,3,3,1,0,1,1,2,1,1,0,1,4,0,2,2,1,0,4,4,3,3,0,0,3,3,1,0,3,2,2,5,4,5,5,4,2,2,2,2,6,1,7,0,1,1,5,0,0,3,1,2,3,9,0,7,5,1,3,2,1,2,0,4,4,2,1,2,1,1,7,8,5,5,1,9,11,5,8,8,8,7,10,7,5,3,10,1,1,5,1,13,16,2,8,5,2,7,4,7,2,5,7,4,2,2,5,8,10,15,4,2,10,2,6,1,5,2,2,0,4,0,0,3,7,8,14,1,2,2,5,2,3,8,2,6,10,7,19,7,1,3,1,7,4,0,14,6,10,6,27,13,1,3,2,8,2,4,8,13,21,0,6,12,2,8,11,8,6,2,6,5,3,2,9,3,1,9,9,15,2,7,14,2,1,12,5,10,18,9,0,12,14,19,7,26,34,11,6,4,14,7,5,3,41,26,22,2,11,6,50,23,16,14,23,0,18,16,19,7,2,14,3,25,2,19,11,8,1,4,7,1,12,7,1,19,23,6,4,6,3,9,11,5,24,7,9,4,8,2,19,4,3,7,18,15,4,0,21,1,0,7,10,1,15,7,6,4,3,7,2,2,2,4,2,3,2,5,13,15,7,16,1,12,5,4,7,4,9,8,12,0,2,4,1,11,1,8,5,4,15,4,22,5,0,4,6,3,3,2,1,6,7,0,7,1,5,3,1,4,7,5,5,1,1,8,5,4,2,8,2,0,1,9,3,1,3,8,1,6,4,1,3,5,6,4,6,3,2,0,4,1,3,0,2,1,3,4,3,8,4,4,11,2,1,5,1,0,1,3,2,6,2,6,2,0,0,1,3,2,3,5,5,2,2,2,1,1,1,0,2,0,2,3,2,1,4,3,2,1,1,3,1,0,3,1,1,1,2,1,0,1,3,1,1,0,0,1,1,0,0,1,0,1,0,1,0,0,0,0,0,0,0,0,1,1,0,1,1,0,2,0,1,0,2,1,2,0,3,0,1,1,1,3,3,2,4,3,1,0,1,3,2,0,1,1,0,0,2,1,5,3,3,5,3,2,1,2,2,1,2,6,2,5,0,4,1,1,1,4,11,1,4,3,3,8,3,5,2,2,3,0,4,0,1,1,6,4,5,3,3,4,5,2,1,5,3,8,3,0,1,10,2,1,2,8,5,3,1,7,4,2,6,6,1,5,5,3,8,2,7,2,1,4,3,1,6,2,0,5,22,5,15,4,4,3,0,9,1,11,2,5,13,1,9,7,7,3,4,5,1,12,6,15,14,16,2,5,2,3,2,3,2,2,3,7,5,5,15,7,10,0,0,7,21,1,4,0,18,15,3,6,19,4,7,1,9,4,25,8,11,5,3,10,4,7,23,6,2,18,12,8,7,0,1,4,11,7,2,18,3,24,2,14,19,7,18,16,23,2,16,13,50,24,11,5,22,2,40,26,5,2,13,8,6,3,35,10,7,26,15,18,0,12,18,8,5,11,1,12,15,1,2,8,9,17,0,8,9,4,3,2,6,4,6,3,10,9,2,8,6,13,21,0,7,14,1,3,1,7,1,2,27,13,10,6,15,5,5,1,2,8,2,4,18,6,11,8,1,5,3,8,5,1,2,0,13,0,6,9,1,4,4,0,2,0,4,3,6,1,10,1,4,2,10,14,5,9,2,2,7,3,2,5,5,6,3,6,8,6,17,3,1,13,1,4,9,2,5,3,10,7,7,8,8,8,11,6,0,8,4,6,7,9,0,2,1,1,5,3,0,4,1,1,3,2,5,1,1,6,3,8,1,3,0,4,5,0,2,0,7,0,5,2,2,3,3,1,5,3,4,5,1,6,2,1,0,1,3,3,0,1,3,4,4,5,0,1,2,2,4,0,1,0,0,2,1,2,0,1,3,1,1,2,5,4,5,1,4,0,8,1,0,0,1,5,6,1,5,4,3,3,2,7,3,14,0,11,5,28,21,4,14,2,3,2,4,4,27,1,2,5,17,1,5,14,3,1,4,2,18,5,12,0,13,9,4,5,2,2,1,4,1,0,2,3,8,5,2,3,1,7,8,4,6,0,2,1,10,14,1,10,2,5,5,4,0,4,3,4,2,2,5,2,1,3,0,8,3,13,8,2,1,1,2,4,1,3,4,5,2,6,7,2,0,1,1,1,1,1,7,1,8,8,1,5,3,0,1,4,3,3,0,1,2,0,5,2,1,0,4,0,2,2,3,2,6,2,2,4,13,0,1,5,1,1,5,6,2,7,3,2,2,3,1,5,6,6,10,1,5,5,8,3,5,4,0,1,0,1,1,2,4,3,1,1,1,0,2,1,4,0,5,5,6,2,5,1,2,1,4,3,2,3,2,0,2,3,3,0,3,2,4,3,2,2,0,7,5,4,11,3,2,16,15,9,5,16,5,1,9,8,5,9,18,8,8,17,2,0,5,4,6,2,9,12,3,4,4,1,3,1,0,1,7,3,9,1,0,2,3,1,0,1,0,1,1,2,0,1,5,3,1,2,11,4,5,0,1,2,5,1,2,1,4,3,2,1,2,0,7,7,9,5,1,4,3,4,0,2,1,1,1,1,0,3,2,0,1,1,4,0,1,4,2,2,1,0,4,1,0,2,0,2,3,2,0,1,0,0,1,1,1,2,0,3,2,2,1,1,0,2,1,1,1,1,0,1,1,1,1,1,1,2,5,12,2,4,5,4,2,2,1,2,2,1,3,4,4,3,0,4,2,4,1,13,7,2,4,2,2,3,4,0,1,2,0,0,1,3,3,3,3,0,2,2,3,1,1,1,0,0,2,2,0,1,1,2,1,2,1,3,1,1,1,0,6,4,3,0,1,2,1,1,2,2,2,2,0,2,2,2,2,1,1,1,1,0,4,3,1,3,1,1,3,1,6,1,0,3,2,2,2,5,0,2,3,1,1,3,4,1,2,3,3,3,0,3,0,1,8,3,1,2,3,8,12,6,7,9,4,5,5,2,2,1,8,0,6,4,5,0,7,1,2,4,6,1,4,6,2,4,1,4,2,1,0,2,1,1,3,3,2,1,1,2,1,3,1,1,5,5,7,1,0,1,2,3,2,3,3,0,1,1,1,3,0,2,2,3,5,2,4,2,4,5,3,3,1,1,7,8,12,19,3,2,13,16,20,20,6,27,31,9,2,10,15,8,11,8,19,8,14,11,35,24,4,3,22,14,5,9,3,7,6,11,4,30,2,9,4,0,10,0,6,4,2,2,6,3
3,0,5,1,5,6,8,6,6,3,0,1,8,2,16,10,3,11,14,2,5,12,18,23,4,20,26,14,10,5,20,26,0,2,6,7,1,10,6,20,18,19,5,1,2,7,5,15,9,9,5,1,20,0,8,1,1,7,0,3,5,4,0,1,3,1,3,1,5,3,3,2,5,9,3,1,5,2,1,2,1,1,4,8,4,1,7,3,1,4,1,3,4,3,4,1,5,1,1,1,9,3,4,8,1,3,0,3,2,2,2,2,7,2,8,2,0,7,9,2,22,3,5,4,4,1,5,4,9,7,4,5,6,2,5,4,1,3,0,3,3,4,6,0,3,2,11,1,1,4,1,4,7,1,4,3,2,0,3,2,3,2,2,3,0,3,2,1,1,1,1,3,0,2,3,2,1,5,3,1,4,2,4,1,3,4,4,4,1,0,2,2,1,0,3,1,0,2,5,1,1,0,1,0,4,2,5,1,2,1,3,5,2,6,2,0,2,1,0,1,8,4,3,4,1,9,1,1,1,2,3,3,0,3,5,3,4,6,4,3,3,1,1,1,5,2,5,1,0,1,3,2,1,1,1,5,2,0,2,5,3,1,3,4,2,1,4,3,5,3,5,1,5,2,1,1,1,1,0,1,4,2,3,0,1,1,1,5,8,2,2,2,6,4,1,2,0,1,3,2,3,3,0,3,2,9,3,2,1,13,4,5,1,1,1,2,3,0,2,0,3,2,1,0,1,3,7,1,2,9,1,1,2,3,3,2,1,1,9,6,6,3,0,2,10,3,8,14,6,8,11,1,5,6,3,3,8,4,1,3,2,3,2,6,2,7,5,11,5,2,13,7,3,18,2,7,8,2,11,4,4,5,5,8,6,5,11,2,3,2,8,1,2,1,2,5,3,7,2,0,3,4,1,1,5,0,5,4,3,5,3,5,1,2,7,2,4,2,7,7,5,0,2,3,3,2,1,6,11,14,2,2,12,8,1,4,4,3,1,12,0,5,4,7,4,0,2,4,1,9,3,1,10,10,8,4,7,3,5,4,3,3,0,4,9,4,4,13,3,0,4,4,5,3,8,8,1,6,6,1,7,6,4,2,0,10,4,4,8,1,2,1,9,12,10,2,5,1,4,2,0,2,2,6,1,2,19,3,9,6,23,8,22,6,7,0,2,2,7,13,16,1,3,1,1,9,0,10,7,6,5,9,10,4,1,5,7,6,4,1,2,5,3,1,1,2,0,11,3,6,3,10,2,2,6,10,4,7,1,1,3,2,9,7,2,8,7,5,3,1,7,3,11,3,5,2,1,1,4,0,4,1,0,6,5,8,7,2,1,2,4,2,0,1,2,2,1,4,2,3,3,1,2,6,0,1,4,3,2,0,4,0,0,0,1,0,10,4,2,4,3,3,2,5,1,0,6,1,5,5,4,0,3,6,9,1,5,1,2,0,6,6,7,2,2,15,3,4,5,14,0,5,16,5,1,1,10,2,3,13,0,3,5,1,3,5,2,6,12,1,6,4,3,0,8,1,3,4,4,2,0,5,1,0,1,2,3,7,1,0,3,4,2,3,6,0,3,3,1,5,6,6,3,0,1,2,10,4,6,1,3,6,1,0,2,5,2,1,1,3,6,7,9,4,8,3,13,3,3,7,0,2,20,3,26,9,3,9,9,7,11,10,7,3,4,0,2,10,2,15,16,8,20,14,4,8,16,6,10,3,13,16,3,2,4,16,1,10,9,7,7,10,11,6,8,24,26,10,6,17,24,2,9,19,10,15,0,5,9,14,28,10,29,18,20,10,53,4,1,13,5,39,40,12,25,18,20,6,13,10,10,13,16,9,0,8,17,10,19,22,15,16,23,12,1,9,9,23,13,4,19,0,29,42,4,14,10,5,27,11,12,21,33,14,19,10,14,20,9,3,13,13,3,4,10,3,0,10,14,27,2,22,11,11,1,11,12,3,7,13,1,9,6,3,2,5,12,1,14,4,11,12,4,12,13,4,3,14,6,3,14,11,7,9,0,13,3,7,14,2,1,5,5,2,7,0,7,4,16,12,5,0,5,17,15,16,1,7,16,9,10,2,6,11,6,14,4,1,4,8,5,8,7,3,2,7,2,0,5,0,2,7,0,11,5,7,7,1,4,7,7,3,8,3,4,5,9,9,5,1,2,3,3,4,2,2,4,1,3,1,2,2,2,0,2,1,0,4,1,2,0,0,3,0,1,0,2,1,0,0,2,1,2,0,3,1,1,0,2,2,1,1,1,2,0,1,3,2,0,1,1,0,1,0,1,1,1,1,0,1,0,0,0,1,0,0,0,0,0,1,0,1,0,0,1,1,1,1,0,1,0,2,2,1,1,0,1,1,0,0,2,2,0,1,3,1,2,0,2,1,0,0,2,1,2,1,3,1,0,0,1,3,0,2,1,2,2,1,2,2,3,0,4,1,2,2,3,3,1,4,4,0,9,9,5,4,8,3,6,2,3,8,7,1,5,8,0,12,3,6,5,1,2,1,2,7,7,4,5,8,4,8,4,1,6,15,6,12,10,2,16,8,1,6,15,15,5,17,5,0,15,11,7,4,8,1,5,3,0,5,13,1,3,7,0,12,8,8,14,12,6,2,3,14,13,3,4,13,11,12,14,5,11,1,2,4,5,4,1,8,6,12,12,3,1,11,11,11,2,21,14,26,0,9,10,3,3,4,13,13,9,3,14,21,19,10,33,13,13,20,27,10,10,5,4,14,29,42,18,1,13,3,9,24,1,10,23,13,15,16,19,22,16,9,0,9,16,8,10,13,14,9,20,6,24,17,40,12,4,40,1,13,53,4,20,11,28,17,28,11,8,13,0,6,10,16,9,18,25,3,6,16,26,9,8,24,11,6,7,9,9,8,1,10,4,17,2,3,13,16,10,4,16,5,5,7,20,15,16,7,2,16,2,11,3,1,7,3,11,10,9,7,3,8,26,9,20,2,0,2,3,7,13,2,8,4,9,2,6,6,1,4,3,0,2,4,1,0,3,6,6,0,10,5,1,1,4,1,6,5,1,5,2,4,6,0,3,2,2,5,2,1,4,6,1,2,1,1,0,6,3,1,3,4,8,1,3,1,6,4,12,3,2,6,3,5,5,0,0,3,3,13,10,1,0,0,16,5,1,6,5,12,4,5,2,16,7,1,6,5,3,0,4,2,9,1,3,5,4,1,4,4,6,1,2,1,2,5,3,4,2,4,10,4,0,1,1,1,4,1,2,0,3,4,0,0,2,4,3,1,1,2,1,3,1,3,0,1,4,2,1,3,8,1,4,9,0,6,4,2,4,1,1,0,4,1,10,4,7,4,3,1,8,4,2,7,10,8,3,3,0,2,4,7,6,9,2,2,3,9,2,7,0,12,1,2,3,1,2,4,3,0,7,6,1,4,10,5,5,9,7,6,0,9,2,8,4,2,17,0,7,14,2,3,7,2,22,7,23,8,9,6,19,4,0,2,2,6,0,2,4,2,5,1,10,2,9,12,2,1,8,1,4,4,0,10,3,2,8,7,6,0,1,6,8,8,5,4,4,3,3,1,3,13,9,4,0,4,3,3,6,3,7,3,7,5,10,11,3,1,1,9,2,4,3,1,4,7,0,5,1,13,4,3,1,4,12,8,2,1,11,13,1,6,3,2,3,3,6,0,7,7,4,2,7,2,1,2,2,5,3,6,5,3,5,1,1,1,3,4,2,0,3,7,2,5,2,1,8,1,3,2,11,2,5,5,4,8,5,5,10,4,7,1,3,7,4,18,13,7,5,2,5,11,1,6,3,6,2,3,1,3,7,4,3,3,5,5,11,1,5,8,8,14,9,3,1,3,5,3,8,6,1,1,3,3,2,2,2,0,3,8,7,1,2,3,2,0,2,2,3,1,3,0,2,2,2,1,4,5,0,13,3,2,3,8,0,3,3,3,3,2,1,0,0,3,5,4,2,2,7,2,0,5,1,2,2,1,3,3,0,2,1,1,0,1,4,2,4,1,4,2,4,3,1,1,2,5,3,1,3,6,2,0,0,4,0,0,4,3,0,1,5,1,4,1,1,1,4,1,4,3,3,6,5,3,1,3,2,3,2,2,0,1,2,9,2,4,7,4,0,1,0,1,2,0,1,7,2,5,1,0,4,1,5,2,2,0,0,0,3,1,0,2,4,0,1,0,2,2,0,1,3,5,4,5,5,1,4,2,2,0,1,5,3,2,1,2,0,3,0,2,2,1,1,3,1,3,2,1,2,2,2,0,3,2,6,0,3,4,0,5,10,1,2,1,6,1,2,4,1,3,0,4,6,4,7,1,3,5,9,7,7,4,5,1,4,4,21,2,8,2,1,7,7,2,8,2,1,1,3,2,1,3,0,3,4,7,8,3,0,1,4,0,3,1,3,3,1,3,1,4,6,4,4,1,3,8,0,1,1,3,3,3,2,1,4,8,2,2,6,3,4,2,2,1,2,1,5,4,2,3,2,8,7,1,19,1,7,1,8,9,4,15,1,7,4,1,19,19,5,20,3,10,6,7,1,2,18,26,9,5,27,15,5,20,19,23,6,12,12,3,5,10,14,9,10,1,2,0,5,3,6,7,3,7,3,1
2,0,1,2,2,1,2,6,2,2,9,2,6,10,18,6,5,26,4,8,18,15,1,7,6,6,23,7,10,4,11,6,9,4,2,5,4,2,9,23,11,8,11,9,8,18,12,7,4,37,2,6,1,8,1,1,1,0,2,1,2,2,6,3,1,0,1,1,3,2,1,2,3,3,3,2,1,1,1,3,1,1,7,4,0,5,4,1,4,1,1,1,3,0,1,2,3,2,0,2,1,9,1,2,6,7,5,5,5,5,2,2,16,15,0,4,0,3,4,2,4,7,13,2,24,6,20,4,6,3,2,7,5,2,15,12,6,3,2,1,3,6,3,2,5,2,2,1,6,3,2,3,2,0,3,2,1,2,1,0,0,0,1,3,3,1,3,1,1,4,2,2,3,0,4,1,2,2,2,0,2,4,3,2,5,0,1,4,1,0,0,2,1,0,1,1,2,2,3,1,4,0,2,4,2,0,2,1,2,3,2,0,2,3,1,2,1,1,4,2,0,3,7,3,3,3,3,3,1,3,1,1,1,2,1,0,4,4,1,1,5,1,1,0,1,2,3,9,3,4,3,1,2,2,1,1,2,1,2,1,1,1,0,2,3,2,3,3,1,0,1,1,3,0,0,0,3,0,1,2,1,0,3,1,6,1,1,0,1,1,1,1,1,3,0,0,3,0,2,0,1,2,2,1,3,3,1,0,1,6,1,2,2,2,1,1,4,1,5,0,5,1,4,1,3,1,3,0,1,6,2,4,1,1,2,3,0,3,1,0,7,1,3,5,3,2,6,1,2,4,3,2,2,3,2,4,9,2,7,5,14,7,4,2,2,4,1,8,2,1,17,0,2,0,7,4,19,1,18,7,5,6,9,0,2,2,1,0,0,6,2,2,5,8,2,2,0,1,1,1,1,1,1,1,1,3,1,1,0,1,4,1,3,0,0,0,3,2,2,7,1,0,7,2,1,2,1,0,8,2,1,0,1,1,1,0,3,0,9,7,0,3,2,6,8,3,3,2,6,6,8,4,3,9,4,1,5,2,2,5,3,4,2,1,4,2,3,1,1,2,5,4,0,2,6,1,5,1,5,2,1,2,3,1,4,4,6,2,2,6,1,0,4,8,8,0,2,4,1,1,2,2,6,1,1,3,1,1,1,6,1,3,8,7,3,5,11,2,0,9,3,5,6,18,6,1,12,2,3,8,3,5,7,6,4,10,4,1,6,2,6,0,6,4,5,2,10,3,3,5,12,4,1,1,7,2,6,3,0,1,2,1,13,5,7,11,1,14,3,7,2,3,8,8,4,6,5,7,1,4,9,7,4,5,2,3,3,6,3,3,0,2,8,5,0,3,3,2,0,1,1,2,3,4,1,1,4,1,1,2,0,4,1,2,6,2,1,1,1,3,4,1,1,2,5,1,1,1,4,3,3,1,1,3,3,5,2,2,4,3,3,3,3,2,2,2,3,0,4,3,3,3,4,3,4,1,3,2,8,1,5,1,5,6,10,7,12,3,5,9,11,5,9,2,6,4,3,5,1,4,8,2,4,1,8,3,3,0,4,0,0,3,1,0,3,2,3,1,4,3,2,5,0,11,9,4,1,1,2,2,8,4,10,3,0,2,7,19,5,0,16,3,1,3,3,14,0,7,8,2,3,2,2,2,1,8,10,10,4,9,3,4,4,10,5,0,8,4,3,3,13,2,1,7,4,6,11,9,13,12,6,1,5,6,2,10,7,1,1,4,2,4,6,3,12,4,4,5,7,18,14,18,1,23,6,6,3,6,13,7,28,15,1,19,2,27,21,41,0,9,16,9,8,26,15,28,2,7,5,5,6,0,10,6,19,35,10,12,9,4,3,17,28,5,11,20,37,1,9,16,25,10,5,24,24,9,15,10,1,22,1,6,4,29,2,7,6,3,14,10,8,9,14,8,8,22,3,1,17,7,6,6,0,16,2,4,5,1,1,15,3,21,14,3,3,7,10,3,1,14,11,1,9,6,4,5,7,5,11,6,1,5,3,0,2,0,11,9,7,9,4,18,6,1,5,7,3,0,2,2,1,3,3,6,5,11,4,1,13,6,13,1,11,14,5,6,10,5,8,11,9,2,4,12,7,6,4,8,7,5,7,0,4,4,4,2,8,1,4,2,3,1,2,2,4,4,2,3,1,0,1,4,3,2,5,1,3,3,3,2,1,1,0,2,1,1,1,1,0,1,0,0,2,1,0,3,2,4,2,2,3,1,1,1,0,0,2,0,1,3,3,1,1,0,2,1,2,1,1,0,2,0,1,1,1,2,2,0,1,1,1,0,1,0,1,0,1,1,1,1,1,1,1,1,1,2,1,1,2,0,1,1,1,1,1,2,1,1,3,0,0,2,2,0,0,1,1,0,3,1,2,2,2,3,1,2,2,2,0,0,0,0,0,0,1,2,0,1,1,0,3,3,3,4,5,0,2,3,1,4,1,0,2,3,4,5,2,1,2,2,4,1,8,2,4,4,5,5,7,0,7,5,4,7,6,5,4,12,9,1,7,12,10,5,5,7,11,12,13,1,13,6,4,2,5,11,4,5,1,3,1,3,4,1,5,6,7,2,4,18,7,8,11,10,2,0,3,1,2,4,11,6,7,6,4,6,9,7,11,1,1,13,10,3,2,8,13,2,3,21,0,16,5,1,3,3,0,16,6,4,17,6,3,2,8,23,13,7,7,8,13,9,5,4,1,7,4,29,2,7,2,21,15,10,24,10,5,22,26,11,10,15,37,1,11,21,28,5,3,16,9,5,10,12,18,34,9,7,5,1,5,4,2,6,15,27,8,25,16,9,0,10,21,41,1,26,1,19,29,14,13,7,3,7,6,7,1,24,14,18,8,17,3,4,12,4,6,3,2,5,1,4,8,0,3,9,4,7,5,0,13,13,11,9,4,7,0,6,13,4,3,4,8,5,4,1,4,9,3,4,4,10,10,10,1,8,2,3,3,1,8,2,0,8,3,15,1,2,15,4,5,1,7,18,1,1,11,4,7,5,2,2,2,1,9,4,1,12,2,6,4,3,2,2,3,2,1,1,0,3,4,1,2,1,8,4,4,2,8,2,1,5,4,4,5,4,9,1,10,4,5,10,12,4,11,6,5,6,5,1,8,0,3,3,4,1,4,3,3,2,4,4,3,0,2,2,4,3,2,2,4,3,1,2,2,4,1,2,2,0,3,2,1,1,4,0,1,3,3,2,1,2,1,0,5,1,2,1,1,5,1,3,4,1,1,1,3,3,1,2,0,2,3,2,1,2,8,5,0,4,2,2,3,5,2,2,4,4,8,8,1,4,5,7,3,5,9,7,1,2,3,6,1,15,7,12,13,5,2,1,1,0,6,3,7,1,0,2,12,3,2,4,10,3,5,1,6,5,6,1,6,1,3,0,4,10,6,5,3,4,3,8,11,3,6,0,6,18,3,4,1,8,10,1,3,4,8,7,1,3,1,6,1,1,2,2,6,1,2,1,1,2,2,3,8,0,4,7,1,1,2,5,6,1,4,4,2,1,1,3,5,1,5,0,6,1,1,2,5,4,1,1,3,0,4,2,2,2,3,4,2,5,5,2,4,2,3,8,8,4,6,6,3,1,8,3,2,6,1,3,9,7,4,0,0,0,1,1,1,0,8,2,1,0,1,2,6,1,2,0,3,8,2,2,0,1,2,0,3,0,1,2,1,2,2,2,0,1,1,1,1,1,1,0,2,2,4,7,2,2,1,6,1,0,2,2,9,0,5,6,18,7,20,2,7,4,3,1,17,1,1,2,2,8,1,5,4,2,14,7,7,5,9,2,1,4,2,3,2,1,2,5,6,1,3,2,3,5,6,1,1,0,0,2,2,3,2,1,3,4,2,6,3,0,2,1,3,1,4,2,6,0,3,0,1,1,1,2,1,2,2,7,1,0,2,2,3,0,0,3,2,0,2,1,0,0,0,3,0,1,0,1,2,0,5,1,2,1,0,0,1,2,2,1,0,1,2,0,1,1,1,0,2,2,2,2,1,1,1,1,1,2,1,0,1,1,2,2,2,1,2,4,2,8,0,2,0,0,4,0,0,1,3,3,1,0,2,2,1,1,1,3,2,3,2,4,6,2,1,2,3,2,0,0,2,2,3,4,1,0,2,3,2,1,1,0,1,4,4,0,2,1,1,2,0,1,1,0,1,2,1,0,2,5,5,1,3,2,1,4,1,1,2,2,3,2,3,1,1,2,0,4,3,1,3,0,0,3,1,1,1,0,0,1,3,2,2,1,0,3,5,2,2,0,4,1,5,2,2,6,3,0,6,3,14,12,5,2,2,6,6,3,19,4,23,6,15,2,5,7,5,2,2,3,0,4,17,15,3,2,6,5,4,6,5,7,2,1,2,9,1,3,2,2,0,1,2,0,2,1,3,1,3,1,1,5,5,4,2,2,2,3,0,0,1,2,2,3,0,2,4,2,0,1,3,0,5,2,3,1,1,0,2,1,0,0,2,8,3,5,5,36,10,7,9,19,10,8,10,8,7,24,3,2,4,5,8,4,9,6,8,4,24,7,7,5,2,7,16,15,5,7,4,25,16,6,5,11,10,3,1,1,1,5,4,2,3,1
6,0,8,1,8,7,15,1,6,13,1,6,9,10,1,18,16,13,14,9,36,6,2,1,8,25,7,14,20,3,5,17,9,25,11,23,6,8,8,7,27,14,1,16,7,3,2,14,12,1,3,3,12,5,3,7,2,6,5,3,3,0,3,5,3,5,1,3,2,6,0,3,5,2,6,5,1,2,3,1,1,2,9,4,2,0,4,2,4,1,0,0,1,5,2,0,0,1,1,3,2,1,0,2,3,2,7,4,1,2,6,2,2,4,8,9,4,1,9,3,2,6,9,5,0,7,2,1,8,1,3,3,3,6,7,4,6,6,0,2,5,11,4,3,6,0,1,2,4,3,2,2,1,2,6,0,1,2,1,0,6,3,2,0,1,2,4,0,4,3,2,1,0,1,3,1,0,2,2,1,2,1,1,4,0,1,2,4,0,5,0,1,1,1,1,1,2,1,1,2,2,0,1,4,5,1,2,2,2,5,5,2,2,1,1,3,5,1,0,1,5,1,5,6,3,0,5,2,1,1,2,4,2,2,4,3,1,1,0,6,1,4,1,2,5,2,2,4,1,2,1,2,2,0,3,0,1,1,4,3,0,0,2,1,2,3,2,0,1,2,7,0,0,0,2,3,2,0,0,2,2,2,2,0,3,1,1,3,3,1,1,1,3,3,0,6,0,1,2,2,2,1,2,1,1,1,1,6,1,1,1,7,10,2,4,1,2,1,3,2,2,0,1,0,0,2,1,1,2,2,4,0,7,1,2,3,5,4,6,0,10,4,6,3,1,5,4,3,0,4,7,2,5,6,1,2,7,3,2,7,5,3,2,4,0,8,10,7,6,16,13,0,3,3,5,2,21,16,19,7,13,2,10,12,5,2,1,0,3,10,5,3,0,8,3,6,4,1,4,5,2,0,2,4,0,1,1,0,1,1,2,6,1,0,10,0,4,2,1,4,5,8,2,1,7,2,10,4,4,1,2,2,7,5,1,1,0,3,6,9,3,10,6,3,0,1,3,8,7,6,1,0,1,3,7,3,1,2,3,1,2,3,3,5,2,6,3,6,3,4,4,5,2,1,2,9,1,2,8,2,9,2,8,1,0,10,7,7,2,1,0,0,12,8,1,3,4,1,3,5,6,16,5,1,9,1,5,13,2,9,10,7,3,10,6,5,1,3,4,8,2,17,9,11,7,16,7,1,6,11,7,2,4,1,4,14,4,5,8,4,5,3,8,5,7,2,9,3,4,4,2,6,3,2,1,7,2,10,7,1,5,4,1,2,8,4,3,1,7,1,4,10,7,8,1,3,5,2,1,2,2,3,1,1,3,0,2,2,4,2,2,2,2,2,1,0,0,1,4,0,1,4,3,2,7,0,2,3,0,4,5,5,2,4,1,4,0,1,2,3,2,1,0,1,1,0,5,12,3,6,2,5,1,1,8,1,10,4,4,3,4,7,2,16,7,6,1,3,9,1,9,6,0,3,3,1,9,2,0,2,4,13,1,2,8,2,4,3,2,5,11,1,2,5,5,1,1,3,4,3,1,2,4,8,2,4,3,4,5,1,0,2,1,1,3,2,0,2,1,5,1,2,1,2,2,2,4,1,2,1,4,0,5,0,2,2,8,4,1,3,4,4,7,4,9,1,10,0,1,3,3,3,1,7,4,7,2,4,6,12,1,0,6,9,4,3,1,1,9,8,6,1,11,10,10,0,10,1,9,11,9,2,8,5,13,7,4,8,6,29,7,33,8,1,17,16,27,7,42,12,11,27,25,17,39,9,31,41,5,33,3,17,45,1,23,45,25,25,33,16,54,6,37,2,49,2,21,33,33,1,7,16,25,13,5,4,25,0,6,4,1,24,2,13,1,3,10,2,4,18,21,12,8,3,6,2,3,12,14,9,8,17,14,8,9,9,18,5,7,39,15,6,6,2,1,25,11,5,10,18,27,21,22,6,27,7,14,1,30,10,5,12,9,7,0,1,18,4,9,4,13,3,1,7,7,4,3,3,9,2,8,27,11,18,0,24,15,18,14,11,4,6,16,2,4,4,11,16,3,0,10,6,10,0,14,5,0,3,4,2,6,16,2,9,17,3,1,15,6,2,10,3,6,6,1,4,8,3,6,5,7,3,4,7,2,2,3,3,2,3,3,2,5,1,1,2,2,4,1,1,0,0,1,1,0,1,2,2,0,1,3,4,1,1,1,0,2,2,3,5,1,0,1,3,2,0,0,2,4,2,2,2,4,2,3,1,1,1,4,0,1,1,2,1,2,2,1,1,2,2,0,3,1,1,0,3,2,1,1,1,2,0,2,0,1,0,1,1,2,1,1,1,1,0,0,3,1,0,0,3,2,1,1,1,2,2,2,1,1,2,4,1,1,1,3,1,4,1,3,1,3,2,0,0,1,1,1,2,1,1,3,4,2,3,1,0,1,2,3,3,0,2,1,1,0,0,1,1,0,1,2,0,2,4,1,2,4,2,3,3,2,2,3,2,2,2,4,8,7,4,6,5,8,1,1,3,6,8,10,4,6,2,1,14,17,4,2,8,7,15,4,2,0,2,14,6,10,1,10,5,3,0,11,16,4,3,16,2,4,6,14,11,15,18,0,24,11,19,8,27,9,3,3,2,7,3,1,8,12,4,9,3,17,5,0,1,10,6,6,13,29,9,14,1,26,8,22,5,27,20,10,19,10,6,1,25,6,1,15,7,6,38,18,6,10,9,14,7,8,17,14,9,3,11,6,2,8,4,21,12,4,17,9,2,1,3,3,14,1,23,6,4,26,1,5,5,25,14,7,17,34,0,21,34,49,2,37,3,54,6,33,16,25,25,23,44,45,1,3,16,5,33,31,40,39,8,25,19,11,27,42,11,28,6,18,15,8,1,7,33,6,29,4,9,13,6,9,4,8,1,8,10,10,1,11,1,11,9,7,1,9,8,1,0,4,3,6,8,0,1,6,11,2,3,4,8,1,7,3,3,1,2,10,1,9,0,7,4,4,5,1,3,9,3,2,3,5,0,4,2,2,1,3,2,2,3,1,1,1,1,2,4,0,1,3,1,1,1,1,1,5,0,3,3,2,3,4,8,2,1,4,3,1,4,5,1,2,4,11,0,1,4,4,2,7,1,1,1,4,13,0,3,9,1,3,1,1,2,10,7,8,0,1,4,7,6,2,16,5,8,4,2,10,3,8,1,1,0,1,4,4,5,5,11,1,1,1,2,2,0,3,3,1,0,1,3,2,3,4,4,1,3,2,2,7,1,3,2,1,3,4,0,0,1,1,0,3,3,2,3,4,1,1,3,2,1,1,0,2,3,1,2,5,2,1,3,7,8,5,9,7,0,3,2,8,4,1,1,5,3,7,1,2,9,1,6,2,1,1,7,3,3,8,4,7,1,8,4,6,4,7,3,4,6,5,15,4,0,7,2,6,11,7,1,7,15,9,10,3,16,3,7,1,4,7,4,3,10,10,6,2,9,5,13,9,1,5,1,6,15,4,6,4,0,2,4,12,7,0,0,2,1,7,7,0,10,8,1,9,1,8,2,1,1,2,9,2,2,4,5,3,3,3,6,2,6,3,5,2,3,4,1,1,1,7,3,1,3,1,1,7,5,3,8,0,1,6,3,3,10,6,8,0,2,1,1,7,5,1,1,4,2,10,4,6,2,2,0,5,8,2,5,5,1,9,0,0,0,2,5,1,1,1,1,1,1,1,4,3,0,5,5,4,2,3,6,1,8,5,3,3,9,1,1,6,2,9,11,13,2,18,7,21,16,5,3,4,4,13,0,6,16,10,7,0,8,2,4,4,2,1,7,6,3,2,1,5,5,6,3,1,4,5,3,1,5,6,3,10,4,5,1,4,4,3,3,8,1,4,0,3,1,1,1,1,3,1,1,1,1,2,1,1,0,3,0,10,2,1,7,2,1,1,5,0,1,2,0,1,1,2,1,1,1,1,5,3,3,2,1,2,2,0,3,4,1,2,0,2,3,1,2,1,1,1,2,0,0,6,1,1,2,2,0,2,3,2,1,0,0,3,2,1,0,3,0,2,0,1,2,0,1,1,4,5,2,2,2,0,5,1,5,1,1,4,3,2,2,1,4,2,2,6,1,4,1,4,6,4,0,1,0,4,1,2,3,2,0,5,2,3,5,1,2,4,1,0,3,1,0,1,1,0,1,1,1,0,1,1,1,0,5,1,4,1,1,1,4,2,1,3,1,0,2,2,2,0,1,1,1,5,3,4,0,1,2,1,1,6,2,0,0,0,2,5,0,2,3,3,2,4,3,1,1,6,0,3,3,5,11,1,1,7,6,6,4,2,5,2,2,8,1,1,2,0,7,10,5,4,6,9,4,4,1,9,9,3,4,7,2,0,2,6,4,3,2,1,1,1,1,1,3,1,1,2,0,1,6,1,1,4,0,3,1,1,1,8,4,2,1,3,0,1,1,5,5,4,2,1,3,2,6,2,2,4,5,2,6,2,1,7,3,4,6,2,8,11,6,4,3,11,1,1,14,5,3,1,15,28,15,9,6,8,8,9,23,7,26,7,17,19,3,6,14,7,24,0,1,37,5,13,8,14,13,0,17,10,11,0,7,7,13,13,2,6,7,5,1
5,0,4,1,3,4,11,6,12,5,2,3,18,3,6,25,18,7,7,8,43,2,17,3,5,2,23,2,1,0,26,26,7,9,3,5,5,6,6,2,10,2,14,24,1,12,13,3,1,18,1,4,14,1,2,5,5,1,2,3,5,6,1,2,2,2,3,3,1,2,1,8,2,2,3,2,1,0,3,0,1,2,4,4,0,2,3,3,0,1,5,1,1,2,0,2,4,5,4,1,5,1,2,2,5,3,2,6,6,1,1,1,2,2,2,5,12,5,12,3,6,7,4,0,7,3,7,3,3,2,1,1,0,3,3,1,0,0,3,2,3,1,2,3,2,0,1,2,0,0,0,0,3,2,1,1,2,2,1,1,1,1,1,1,1,2,6,2,0,2,1,1,3,1,0,1,0,0,1,1,0,2,1,2,1,3,4,0,1,1,2,1,2,1,2,1,1,1,2,1,3,0,3,2,0,1,7,3,2,1,0,2,0,1,2,5,0,1,5,2,4,5,2,1,1,1,1,0,4,1,7,4,3,1,1,1,0,4,1,1,3,3,1,3,3,3,3,1,1,0,0,1,2,4,1,1,0,1,0,0,1,1,1,3,3,3,4,1,1,1,2,1,0,0,0,1,0,1,0,1,0,1,1,0,2,0,2,0,1,0,1,3,1,2,0,4,2,1,4,3,0,1,1,2,1,2,1,3,2,3,2,7,4,2,1,3,2,4,0,2,5,3,2,2,0,1,0,0,2,4,7,2,7,2,2,5,1,2,2,4,2,5,3,3,1,2,0,3,2,1,2,2,1,3,2,11,2,10,2,10,1,9,8,3,8,11,7,3,9,5,1,8,10,19,11,3,25,0,17,13,4,2,2,1,0,6,5,4,7,5,3,5,7,1,2,0,0,2,1,2,4,1,3,2,4,0,1,3,2,2,3,4,1,2,3,5,2,2,1,1,1,1,9,3,5,7,7,0,2,4,0,1,10,1,1,2,2,6,1,3,6,3,0,2,9,6,5,9,1,0,2,2,4,3,8,9,2,2,1,6,9,1,2,1,2,1,1,7,3,6,2,1,2,3,5,5,2,0,6,2,0,2,1,3,7,7,2,1,8,3,8,10,0,2,6,2,13,6,1,2,3,4,0,0,3,2,4,3,1,0,4,4,7,3,9,4,3,1,4,3,1,3,2,3,1,8,10,7,7,2,1,9,3,3,1,2,8,9,2,9,3,6,6,1,10,7,3,6,24,18,12,10,11,8,5,1,15,5,0,11,6,16,0,2,1,1,4,12,0,9,3,2,1,2,5,3,7,3,4,5,6,3,3,4,1,1,6,13,3,6,6,14,2,5,7,6,5,3,5,5,1,4,2,1,5,2,4,4,4,3,3,4,9,6,3,7,7,4,2,2,7,5,3,1,1,2,4,1,6,6,4,1,2,2,2,4,2,1,1,2,2,4,3,1,1,5,3,4,2,1,2,0,4,1,2,2,2,5,4,10,1,5,4,4,2,1,4,7,0,7,0,4,3,3,0,2,2,5,5,2,1,3,3,0,5,5,5,2,8,2,1,10,5,6,11,5,10,8,8,3,6,6,14,4,6,15,5,7,14,5,9,12,1,13,2,2,10,8,10,4,1,2,10,0,4,5,5,1,3,5,8,9,3,2,4,7,4,4,8,11,6,9,2,10,8,2,15,5,6,10,1,2,8,0,7,4,2,3,2,3,1,2,22,8,10,9,7,14,2,5,4,8,5,1,0,6,6,3,1,19,6,10,19,2,5,13,7,16,14,30,12,9,5,43,28,44,16,5,2,9,23,10,13,5,16,36,6,32,22,10,4,27,33,10,3,12,2,4,4,16,3,4,2,8,17,7,17,17,1,6,11,7,10,5,4,1,2,6,0,1,4,20,9,7,13,5,2,18,13,11,10,9,15,11,16,1,1,0,5,16,2,13,5,1,2,12,6,3,0,1,17,5,2,21,6,2,15,3,9,4,6,5,2,5,1,6,4,5,4,5,3,3,1,4,4,2,2,5,8,2,3,0,6,4,14,8,4,10,7,19,0,7,15,15,1,5,9,15,7,4,1,7,9,12,12,1,9,10,3,0,9,11,6,5,3,4,8,9,2,4,3,5,6,6,6,2,7,1,1,10,4,1,3,7,1,5,4,8,1,1,8,6,4,1,5,2,2,1,3,2,3,2,1,4,0,1,4,2,3,0,0,4,3,0,2,3,2,2,4,2,1,2,6,1,1,0,4,1,0,3,2,0,0,2,4,2,0,1,3,3,1,0,2,0,0,1,0,1,0,0,1,3,1,1,0,0,1,1,1,3,0,0,0,1,0,2,2,1,1,0,3,2,0,0,3,1,0,1,2,1,0,3,4,1,1,1,6,1,1,1,4,2,2,1,2,4,3,0,0,5,3,1,4,2,1,0,1,4,3,1,2,3,2,1,5,2,4,0,8,5,1,1,4,7,1,5,3,8,4,1,1,9,7,0,5,1,6,6,3,5,1,3,8,8,3,4,5,4,9,12,3,1,9,9,11,0,9,11,1,7,7,2,9,16,1,5,16,14,0,8,7,17,3,9,14,9,5,5,3,0,8,2,1,4,3,3,1,4,3,3,4,5,4,6,0,7,2,5,6,4,8,5,14,2,6,2,1,22,17,4,1,0,6,5,2,12,5,1,2,12,5,16,1,2,16,2,15,11,9,8,13,11,2,18,13,4,9,7,4,21,0,1,2,7,5,0,10,4,11,8,2,5,17,17,16,8,2,8,3,5,4,16,2,3,3,11,32,9,5,26,21,9,6,32,16,37,13,6,22,9,1,8,17,6,28,43,5,43,12,7,14,29,8,17,5,12,19,1,6,10,2,20,6,2,0,6,5,0,4,8,2,6,7,14,11,8,23,7,1,3,2,1,3,4,7,5,8,1,1,3,6,10,14,6,8,1,2,9,6,9,9,11,4,4,4,8,2,3,8,10,3,7,5,1,4,4,9,1,0,3,10,5,9,7,2,3,1,13,9,11,14,6,6,8,6,15,14,5,6,5,8,3,10,9,11,4,5,6,0,11,9,1,5,1,5,4,3,2,0,4,5,3,3,4,0,2,4,3,1,3,0,7,3,6,3,2,4,3,0,6,4,11,2,5,2,1,4,0,2,0,2,0,3,4,2,6,3,0,2,5,2,3,1,2,2,5,1,3,4,0,6,5,4,2,1,0,3,2,7,6,2,2,8,5,3,7,8,5,3,3,4,3,4,5,5,3,3,2,1,5,5,4,5,3,7,6,3,6,6,14,3,6,6,12,1,1,2,3,6,3,5,6,7,4,4,2,1,2,3,1,0,10,5,13,0,0,1,1,6,17,0,10,14,4,5,2,11,8,12,10,24,17,3,6,10,5,6,0,4,5,3,8,8,9,2,1,4,2,1,8,7,3,10,8,1,8,2,4,1,3,4,2,3,1,8,5,7,3,4,4,1,1,3,3,3,2,0,0,2,3,1,3,13,5,6,1,0,3,7,11,8,3,2,1,7,6,1,3,0,2,5,1,2,0,5,5,1,4,2,1,3,5,1,7,2,1,2,1,9,1,1,6,2,2,8,9,5,3,2,1,1,1,5,9,9,6,0,2,6,2,2,3,2,6,1,2,10,1,0,1,2,4,6,0,5,8,7,3,1,0,2,1,3,2,3,5,1,2,2,3,3,2,0,4,3,1,2,2,5,1,1,2,0,2,3,1,8,0,3,5,6,4,5,4,1,6,3,1,4,2,16,13,24,1,10,3,10,18,0,9,9,5,7,3,7,10,7,3,0,10,1,10,2,10,3,10,2,3,2,2,2,1,0,3,0,2,3,3,3,4,3,4,1,2,1,5,7,2,6,1,3,3,0,0,0,1,2,2,4,3,0,2,1,4,1,3,3,1,2,7,2,4,1,3,1,2,0,2,1,0,4,4,2,2,0,4,0,3,1,3,2,1,2,0,1,1,0,1,1,1,1,1,0,1,0,1,0,0,2,0,1,1,5,1,2,2,0,2,2,0,1,1,0,1,2,1,1,5,0,1,2,1,3,2,3,3,1,3,2,3,0,0,0,4,1,1,3,1,7,4,3,1,1,0,2,0,0,1,4,5,5,3,0,2,2,5,2,1,1,2,1,1,5,3,1,1,2,2,2,1,2,1,1,1,2,1,3,1,1,1,0,1,5,0,1,3,0,3,1,1,2,1,0,0,0,1,2,1,0,0,1,1,5,1,0,2,0,1,0,2,2,1,1,2,0,0,3,2,0,1,1,0,1,2,3,0,1,2,2,1,2,2,0,0,2,1,0,3,2,1,4,2,5,3,8,3,5,0,5,7,11,3,11,6,1,5,3,2,0,1,5,2,1,7,6,3,1,2,4,0,5,0,6,5,0,1,1,2,4,1,0,1,2,4,0,2,3,5,3,1,2,0,2,1,2,2,3,1,1,7,1,2,3,3,2,2,0,3,4,5,1,4,5,2,3,5,12,1,0,4,2,17,15,2,0,11,16,24,11,2,5,2,4,6,3,4,6,8,24,26,3,0,24,2,3,2,16,2,41,1,5,8,20,7,7,26,17,2,1,4,10,4,13,7,5,5,6,2

 
  for (int i = 0; i < kFeatureElementCount; i++) {
    //int_model_input_buffer[i] = feature_buffer[i];
    float_model_input_buffer[i] = float(s_1[i] );
  }
*/

  // Prepare to access the audio spectrograms from a microphone or other source
  // that will provide the inputs to the neural network.
  // NOLINTNEXTLINE(runtime-global-variables)
/*
    printf("\n BEFORE FeatureProvider = ");
  static FeatureProvider static_feature_provider(kFeatureElementCount,
                                                 feature_buffer);
  feature_provider = &static_feature_provider;

    printf("\n BEFORE RecognizeCommands = ");
  //static RecognizeCommands static_recognizer(error_reporter);
  //recognizer = &static_recognizer;
*/
  previous_time = 0;
}

void cmsis_fft(int* data, int data_size)
{
  if (data_size != FFT_SIZE){
    printf ("Error data_size=%d != FFT_SIZE=%d",data_size , FFT_SIZE);
    return;
  }

  static arm_rfft_instance_q15 fft_instance;
  //static q15_t s[FFT_SIZE*2]; //has to be twice FFT size
  arm_status status = arm_rfft_init_q15(
         &fft_instance,
         FFT_SIZE, // bin count
         0, // forward FFT
         1 // output bit order is normal
  );

  if (status != 0){
    printf ("\n cannot init FFT");
    return;
  }

  arm_rfft_q15(&fft_instance, (q15_t*)data, s);
  arm_abs_q15(s, s, FFT_SIZE*2);
}  

// The name of this function is important for Arduino compatibility.
void loop() {
  // Fetch the audio
  const int32_t current_time = LatestAudioTimestamp();
  
  int K_MAX=FFT_SIZE / 512;
  int16_t* audio_samples = nullptr;  //4 *512 = 2048 data points
  int audio_samples_size = 0;
  int big_index=0;
  for (int k=0; k<K_MAX; k++) {
      GetAudioSamples(  // one call GetAudioSamples() gives 30ms of audio = 512 data points @16000 Hz
                   error_reporter, 
                   k * kFeatureSliceDurationMs, // TODO
                   kFeatureSliceDurationMs,
                   &audio_samples_size,
                   &audio_samples);

      for ( int j=0; j < audio_samples_size; j++){
        if (big_index >= FFT_SIZE) break;
        fft_samples[big_index] = int (audio_samples[j]);
        big_index++;
      }
      if (big_index == FFT_SIZE) {
          //printf("\n -------- before calling cmsis_fft");
          cmsis_fft( fft_samples, FFT_SIZE);
          //printf("\n -------- after calling cmsis_fft");
      }
      previous_time = current_time;
      //return;
  }
/****************************
  
  int how_many_new_slices = 0;
 
   printf("\n inside loop() BEFORE PopulateFeatureData() = ");
 
  TfLiteStatus feature_status = feature_provider->PopulateFeatureData(
      error_reporter, previous_time, current_time, &how_many_new_slices);
  if (feature_status != kTfLiteOk) {
    TF_LITE_REPORT_ERROR(error_reporter, "Feature generation failed");
    return;
  }
****************************/

  previous_time = current_time;
  // If no new audio samples have been received since last time, don't bother
  // running the network model.
/*
  if (how_many_new_slices == 0) {
    return;
  }
*/
//-------------------------------------
// Copy feature buffer to input tensor
// ---------------------------------  

//for (k=0; k< 100; k++) {
   
  for (int i = 0; i < kFeatureElementCount; i++) {
    //int_model_input_buffer[i] = feature_buffer[i];
    float_model_input_buffer[i] = float(s[i]);
  }
   
  //float input0 = float_model_input_buffer[0] ;
  //printf("\n k=%d input=%f   ", k, float_model_input_buffer[0] );

  // Run the model on the spectrogram input and make sure it succeeds.
  TfLiteStatus invoke_status = interpreter->Invoke();
  if (invoke_status != kTfLiteOk) {
    TF_LITE_REPORT_ERROR(error_reporter, "Invoke failed");
    return;
  }

  // Obtain a pointer to the output tensor
  TfLiteTensor* output = interpreter->output(0);

  float y_val = output->data.f[0];
  //led=1; //off
  printf("\n  model  output=%f",     y_val);
  if (y_val > 0.5) {
        printf ("\n ----Blink---  model output=%f",     y_val  );
         //led = 0; // on
         //ThisThread::sleep_for(2*800); //ms
         //led=1; // off
        //ThisThread::sleep_for(2*800); //ms

  }
/*

  // Determine whether a command was recognized based on the output of inference
  const char* found_command = nullptr;
  uint8_t score = 0;
  bool is_new_command = false;
  TfLiteStatus process_status = recognizer->ProcessLatestResults(
      output, current_time, &found_command, &score, &is_new_command);
  if (process_status != kTfLiteOk) {
    TF_LITE_REPORT_ERROR(error_reporter,
                         "RecognizeCommands::ProcessLatestResults() failed");
    return;
  }
     printf("\n before respond command")  ;  
  // Do something based on the recognized command. The default implementation
  // just prints to the error console, but you should replace this with your
  // own function for a real application.
  RespondToCommand(error_reporter, current_time, found_command, score,
                   is_new_command);

   printf("\n After respond command")  ;              
*/
}
